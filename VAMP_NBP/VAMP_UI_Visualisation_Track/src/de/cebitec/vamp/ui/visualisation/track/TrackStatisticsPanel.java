package de.cebitec.vamp.ui.visualisation.track;

import de.cebitec.vamp.databackend.connector.ITrackConnector;
//import de.cebitec.vamp.databackend.connector.ProjectConnector;
//import de.cebitec.vamp.databackend.connector.RunConnector;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.SwingUtilities;

/**
 *
 * @author ddoppmeier
 */
public class TrackStatisticsPanel extends javax.swing.JPanel {

    private final static long serialVersionUID = 1239345;

    private ITrackConnector trackCon;

    /** Creates new form TrackNavigator */
    public TrackStatisticsPanel() {
        initComponents();
//        Logger.getLogger(this.getClass().getName()).log(Level.SEVERE, "Do not use empty Constructor for this object! Standard constructor is only meant for GUI builder means");
    }

    public TrackStatisticsPanel(ITrackConnector trackCon){
        this.trackCon = trackCon;
        this.initComponents();
        this.hideSeqPairLabels();
        this.computeStats();
    }

    public void setTrackConnector(ITrackConnector trackCon){
        this.trackCon = trackCon;
        this.computeStats();
    }

    public void setTrackName(String name){
        nameLabel.setText(name);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        progressbar = new javax.swing.JProgressBar();
        allReadsLabel = new javax.swing.JLabel();
        uniqueSequencesLabel = new javax.swing.JLabel();
        numUniqueMappingsAbsLabel = new javax.swing.JLabel();
        perfectMappingsLabel = new javax.swing.JLabel();
        bestMatchMappingsLabel = new javax.swing.JLabel();
        numMappingsLabel = new javax.swing.JLabel();
        uniqueSequencesAbsLabel = new javax.swing.JLabel();
        perfectMappingsAbsLabel = new javax.swing.JLabel();
        bestMatchMappingsAbsLabel = new javax.swing.JLabel();
        numMappingsAbsLabel = new javax.swing.JLabel();
        perfPercentageLabel = new javax.swing.JLabel();
        bmPercentageLabel = new javax.swing.JLabel();
        compPercentageLabel = new javax.swing.JLabel();
        perfectPercentage = new javax.swing.JLabel();
        bmPercentage = new javax.swing.JLabel();
        compPercentage = new javax.swing.JLabel();
        labelNameLabel = new javax.swing.JLabel();
        nameLabel = new javax.swing.JLabel();
        numberReadsLabel = new javax.swing.JLabel();
        numberReadsAbsLabel = new javax.swing.JLabel();
        numSeqPairsLabel = new javax.swing.JLabel();
        numSeqPairsAbsLabel = new javax.swing.JLabel();
        numPerfSeqPairsLabel = new javax.swing.JLabel();
        numPerfSeqPairsAbsLabel = new javax.swing.JLabel();
        numUniqSeqPairsLabel = new javax.swing.JLabel();
        numUniqSeqPairsAbsLabel = new javax.swing.JLabel();
        numPerfUniqSeqPairsLabel = new javax.swing.JLabel();
        numPerfUniqSeqPairsAbsLabel = new javax.swing.JLabel();

        setBorder(javax.swing.BorderFactory.createTitledBorder("Global Track Statistics"));
        setPreferredSize(new java.awt.Dimension(200, 400));

        allReadsLabel.setText("Unique Mappings:");

        uniqueSequencesLabel.setText("Unique Seq:");

        numUniqueMappingsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numUniqueMappingsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        perfectMappingsLabel.setText("Perfect:");

        bestMatchMappingsLabel.setText("Best-Match:");

        numMappingsLabel.setText("Mappings:");

        uniqueSequencesAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        uniqueSequencesAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        perfectMappingsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        perfectMappingsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        bestMatchMappingsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        bestMatchMappingsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numMappingsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numMappingsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        perfPercentageLabel.setText("Perfect Coverage:");

        bmPercentageLabel.setText("Best Match Coverage:");

        compPercentageLabel.setText("Complete Coverage:");

        perfectPercentage.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        perfectPercentage.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        bmPercentage.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        bmPercentage.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        compPercentage.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        compPercentage.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        labelNameLabel.setText("Name:");

        nameLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        nameLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numberReadsLabel.setText("Number Reads:");

        numberReadsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numberReadsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numSeqPairsLabel.setText("Sequence Pairs:");

        numSeqPairsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numSeqPairsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numPerfSeqPairsLabel.setText("Perfect Seq. Pairs:");

        numPerfSeqPairsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numPerfSeqPairsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numUniqSeqPairsLabel.setText("Unique Seq. Pairs:");

        numUniqSeqPairsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numUniqSeqPairsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        numPerfUniqSeqPairsLabel.setText("Perf. Uniq. Seq. Pairs:");

        numPerfUniqSeqPairsAbsLabel.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        numPerfUniqSeqPairsAbsLabel.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(progressbar, javax.swing.GroupLayout.DEFAULT_SIZE, 139, Short.MAX_VALUE)
                .addGap(20, 20, 20))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addComponent(perfPercentageLabel)
                        .addComponent(numSeqPairsLabel)
                        .addComponent(labelNameLabel)
                        .addComponent(numMappingsLabel)
                        .addComponent(uniqueSequencesLabel)
                        .addComponent(allReadsLabel)
                        .addComponent(numberReadsLabel)
                        .addComponent(numPerfSeqPairsLabel)
                        .addComponent(numUniqSeqPairsLabel)
                        .addComponent(numPerfUniqSeqPairsLabel)
                        .addComponent(compPercentageLabel)
                        .addComponent(perfectMappingsLabel)
                        .addComponent(bestMatchMappingsLabel))
                    .addComponent(bmPercentageLabel))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(numberReadsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numMappingsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numUniqueMappingsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(uniqueSequencesAbsLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(nameLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numSeqPairsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numPerfSeqPairsAbsLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numUniqSeqPairsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(numPerfUniqSeqPairsAbsLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(bestMatchMappingsAbsLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(perfectMappingsAbsLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(perfectPercentage, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(bmPercentage, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
                    .addComponent(compPercentage, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(labelNameLabel)
                        .addGap(10, 10, 10)
                        .addComponent(numMappingsLabel)
                        .addGap(9, 9, 9)
                        .addComponent(allReadsLabel)
                        .addGap(9, 9, 9)
                        .addComponent(uniqueSequencesLabel)
                        .addGap(9, 9, 9)
                        .addComponent(numberReadsLabel))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(nameLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 15, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(numMappingsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(numUniqueMappingsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(uniqueSequencesAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(numberReadsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(numSeqPairsLabel)
                    .addComponent(numSeqPairsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(numPerfSeqPairsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(numPerfSeqPairsLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(numUniqSeqPairsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(numUniqSeqPairsLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(numPerfUniqSeqPairsLabel)
                    .addComponent(numPerfUniqSeqPairsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(bestMatchMappingsAbsLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(bestMatchMappingsLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(perfectMappingsAbsLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(perfectMappingsLabel, javax.swing.GroupLayout.Alignment.TRAILING))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(perfectPercentage, javax.swing.GroupLayout.PREFERRED_SIZE, 16, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(5, 5, 5)
                        .addComponent(perfPercentageLabel)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(bmPercentageLabel)
                    .addComponent(bmPercentage, javax.swing.GroupLayout.PREFERRED_SIZE, 16, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(compPercentage, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(compPercentageLabel))
                .addGap(15, 15, 15)
                .addComponent(progressbar, javax.swing.GroupLayout.PREFERRED_SIZE, 16, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(100, 100, 100))
        );
    }// </editor-fold>//GEN-END:initComponents


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel allReadsLabel;
    private javax.swing.JLabel bestMatchMappingsAbsLabel;
    private javax.swing.JLabel bestMatchMappingsLabel;
    private javax.swing.JLabel bmPercentage;
    private javax.swing.JLabel bmPercentageLabel;
    private javax.swing.JLabel compPercentage;
    private javax.swing.JLabel compPercentageLabel;
    private javax.swing.JLabel labelNameLabel;
    private javax.swing.JLabel nameLabel;
    private javax.swing.JLabel numMappingsAbsLabel;
    private javax.swing.JLabel numMappingsLabel;
    private javax.swing.JLabel numPerfSeqPairsAbsLabel;
    private javax.swing.JLabel numPerfSeqPairsLabel;
    private javax.swing.JLabel numPerfUniqSeqPairsAbsLabel;
    private javax.swing.JLabel numPerfUniqSeqPairsLabel;
    private javax.swing.JLabel numSeqPairsAbsLabel;
    private javax.swing.JLabel numSeqPairsLabel;
    private javax.swing.JLabel numUniqSeqPairsAbsLabel;
    private javax.swing.JLabel numUniqSeqPairsLabel;
    private javax.swing.JLabel numUniqueMappingsAbsLabel;
    private javax.swing.JLabel numberReadsAbsLabel;
    private javax.swing.JLabel numberReadsLabel;
    private javax.swing.JLabel perfPercentageLabel;
    private javax.swing.JLabel perfectMappingsAbsLabel;
    private javax.swing.JLabel perfectMappingsLabel;
    private javax.swing.JLabel perfectPercentage;
    private javax.swing.JProgressBar progressbar;
    private javax.swing.JLabel uniqueSequencesAbsLabel;
    private javax.swing.JLabel uniqueSequencesLabel;
    // End of variables declaration//GEN-END:variables

    private void computeStats(){
        Thread t = new Thread(new Runnable() {

            @Override
            public void run() {
                //RunConnector runC = ProjectConnector.getInstance().getRunConnector(trackCon.getRunId(),trackCon.getTrackID());
                boolean recalculated = false;
                
                int numSeqPairs = trackCon.getNumOfSeqPairs();
                if(numSeqPairs == 0){
                    numSeqPairs = 0;//trackCon.getNumOfSeqPairsCalculate();
                    if (numSeqPairs == 0){ //seq pair information is only displayed for seq pair tracks
                        TrackStatisticsPanel.this.remove(numSeqPairsLabel);
                        TrackStatisticsPanel.this.remove(numSeqPairsAbsLabel);
                    } else {
                        numSeqPairsLabel.setVisible(true);
                        numSeqPairsAbsLabel.setVisible(true);
                        recalculated = true;
                    }
                }
                
                int numPerfectSeqPairs = trackCon.getNumOfPerfectSeqPairs();
                if (numPerfectSeqPairs == 0) {
                    numPerfectSeqPairs = 0;//trackCon.getNumOfPerfectSeqPairsCalculate();
                    if (numPerfectSeqPairs == 0) {
                        TrackStatisticsPanel.this.remove(numPerfSeqPairsLabel);
                        TrackStatisticsPanel.this.remove(numPerfSeqPairsAbsLabel);
                    } else {
                        numPerfSeqPairsLabel.setVisible(true);
                        numPerfSeqPairsAbsLabel.setVisible(true);
                        recalculated = true;
                    }
                }

                int numUniqueSeqPairs = trackCon.getNumOfUniqueSeqPairs();
                if (numUniqueSeqPairs == 0) {
                    numUniqueSeqPairs = 0;//trackCon.getNumOfUniqueSeqPairsCalculate();
                    if (numUniqueSeqPairs == 0) {
                        TrackStatisticsPanel.this.remove(numUniqSeqPairsLabel);
                        TrackStatisticsPanel.this.remove(numUniqSeqPairsAbsLabel);
                    } else {
                        numUniqSeqPairsLabel.setVisible(true);
                        numUniqSeqPairsAbsLabel.setVisible(true);
                        recalculated = true;
                    }
                }

                int numUniquePerfectSeqPairs = trackCon.getNumOfUniquePerfectSeqPairs();
                if (numUniquePerfectSeqPairs == 0) {
                    numUniquePerfectSeqPairs = 0;//trackCon.getNumOfUniquePerfectSeqPairsCalculate();
                    if (numUniquePerfectSeqPairs == 0) {
                        TrackStatisticsPanel.this.remove(numPerfUniqSeqPairsLabel);
                        TrackStatisticsPanel.this.remove(numPerfUniqSeqPairsAbsLabel);
                    } else {
                        numPerfUniqSeqPairsLabel.setVisible(true);
                        numPerfUniqSeqPairsAbsLabel.setVisible(true);
                        recalculated = true;
                    }
                }
                
                int numOfMappings = trackCon.getNumOfMappings();
                if(numOfMappings == 0){
                   numOfMappings = trackCon.getNumOfMappingsCalculate();
                   Logger.getLogger(this.getClass().getName()).log(Level.INFO, "Updating statistic information");
                   recalculated = true;
                }
                numMappingsAbsLabel.setText(String.valueOf(numOfMappings));

                int numUniqueMappings = trackCon.getNumOfUniqueMappings();
                if (numUniqueMappings == 0) {
                    numUniqueMappings = trackCon.getNumOfUniqueMappingsCalculate();
                    recalculated = true;
                }
                numUniqueMappingsAbsLabel.setText(String.valueOf(numUniqueMappings));

                int numUniqueSequences = trackCon.getNumOfUniqueSequences();
                if (numUniqueSequences == 0) {
                    numUniqueSequences = trackCon.getNumOfUniqueSequencesCalculate();
                    recalculated = true;
                }
                uniqueSequencesAbsLabel.setText(String.valueOf(numUniqueSequences));
                        
                numberReadsAbsLabel.setVisible(false);
                numberReadsLabel.setVisible(false);
                int numReads = trackCon.getNumOfReads();
                if (numReads == 0) {
                    numberReadsAbsLabel.setText("Not available"); //TODO: num of reads can be excluded i think
                } else {
                    numberReadsAbsLabel.setText(String.valueOf(numReads));
                }
                
                int numOfPerfectMappings = trackCon.getNumOfPerfectUniqueMappings();
                if(numOfPerfectMappings == 0){
                    numOfPerfectMappings = trackCon.getNumOfPerfectUniqueMappingsCalculate();//TODO: decide whether unique or not!
                    recalculated = true;
                }
                perfectMappingsAbsLabel.setText(String.valueOf(numOfPerfectMappings));

                int numOfBestMatchMappings = trackCon.getNumOfUniqueBmMappings();
                if(numOfBestMatchMappings == 0){
                    numOfBestMatchMappings = trackCon.getNumOfUniqueBmMappingsCalculate();
                    recalculated = true;
                }
                bestMatchMappingsAbsLabel.setText(String.valueOf(numOfBestMatchMappings));

                double percentagePerfectCovered = trackCon.getPercentRefGenPerfectCovered();
                if(percentagePerfectCovered ==0){
                    percentagePerfectCovered = trackCon.getPercentRefGenPerfectCoveredCalculate();
                    recalculated = true;
                }
                
                double percentageBMCovered = trackCon.getPercentRefGenBmCovered();
                if(percentageBMCovered == 0){
                    percentageBMCovered = trackCon.getPercentRefGenBmCoveredCalculate();
                    recalculated = true;
                }
                
                double percentageNErrorCovered = trackCon.getPercentRefGenNErrorCovered();
                if(percentageNErrorCovered == 0){
                    percentageNErrorCovered = trackCon.getPercentRefGenNErrorCoveredCalculate();
                    recalculated = true;
                }
                
                
                if (recalculated){
                    trackCon.setStatistics(numOfMappings, numUniqueMappings, numUniqueSequences, 
                        numOfPerfectMappings, numOfBestMatchMappings, percentagePerfectCovered, 
                        percentageBMCovered, percentageNErrorCovered, numReads, numSeqPairs, numPerfectSeqPairs,
                        numUniqueSeqPairs, numUniquePerfectSeqPairs);
                }

                String perfectCov = String.format("%.2f%%", percentagePerfectCovered);
                String bmCov = String.format("%.2f%%", percentageBMCovered);
                String nErrorCov = String.format("%.2f%%", percentageNErrorCovered);

                perfectPercentage.setText(perfectCov);
                bmPercentage.setText(bmCov);
                compPercentage.setText(nErrorCov);
                statsFinished();
            }
        }){
        };
        progressbar.setIndeterminate(true);

        t.setPriority(Thread.MIN_PRIORITY);
        t.start();
    }

    private void statsFinished(){
        SwingUtilities.invokeLater(new Runnable() {

            @Override
            public void run() {
                progressbar.setIndeterminate(false);
                progressbar.setVisible(false);
            }
        });
    }

    public void close() {
        trackCon = null;
    }

    /**
     * Used for hiding all sequence pair associated labels until they are really
     * needed.
     */
    private void hideSeqPairLabels() {
        this.numberReadsLabel.setVisible(false);
        this.numberReadsAbsLabel.setVisible(false);
        
        this.numSeqPairsLabel.setVisible(false);
        this.numSeqPairsAbsLabel.setVisible(false);
        this.numPerfSeqPairsLabel.setVisible(false);
        this.numPerfSeqPairsAbsLabel.setVisible(false);
        this.numUniqSeqPairsLabel.setVisible(false);
        this.numUniqSeqPairsAbsLabel.setVisible(false);
        this.numPerfUniqSeqPairsLabel.setVisible(false);
        this.numPerfUniqSeqPairsAbsLabel.setVisible(false);
    }

}
